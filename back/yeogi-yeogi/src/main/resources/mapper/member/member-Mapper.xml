<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MemberMapper">

    <insert id="join">
        INSERT INTO MEMBER
		(
		    NO
            ,NAME
            ,ID
            ,PWD
            ,NICK
            ,PHONE
            ,EMAIL
            ,RESI_NUM
            ,FULL_PATH
		)
		VALUES
		(
		    SEQ_MEMBER_NO.NEXTVAL
            , #{name}
            , #{phone}
            , #{email}
            , #{resiNum}
            , #{fullPath}
		)
    </insert>
    
    <select id="idCheck" resultType="com.yeogi.app.member.vo.MemberVo">
    	SELECT
    		ID
    	FROM MEMBER
		WHERE ID = #{id}    
    </select>
        
    <select id="login" resultType="com.yeogi.app.member.vo.MemberVo">
		SELECT
		    NO
            ,NAME
            ,ID
            ,PWD
            ,NICK
            ,PHONE
            ,EMAIL
            ,ENROLL_DATE
            ,MODIFIED_DATE
            ,FULL_PATH
            ,RESI_NUM
		FROM MEMBER
		WHERE ID = #{id}
		AND PWD = #{pwd}
	</select>
	
	<update id="quit">
		UPDATE MEMBER
		    SET 
		        QUIT_YN = 'Y'
		WHERE NO = #{no}
	</update>
	
	<select id="mySelect" resultType="com.yeogi.app.member.vo.MemberVo">
		SELECT
			NO
            ,NAME
            ,ID
            ,PWD
            ,NICK
            ,PHONE
            ,EMAIL
            ,TO_CHAR(ENROLL_DATE, 'YYYY-MM-DD') AS ENROLL_DATE
            ,TO_CHAR(MODIFIED_DATE, 'YYYY-MM-DD') AS MODIFIED_DATE
            ,FULL_PATH
            ,RESI_NUM
         FROM MEMBER
         WHERE NO = #{no}
	</select>
	
	<update id="edit">
		UPDATE MEMBER
			SET
			   <if test="name != '' and name != null">
	           	,NAME = #{name}
	           </if>
	           <if test="pwd != '' and pwd != null">
	           	,PWD = #{pwd}
	           </if>
	           <if test="nick != '' and nick != null">
	           	,NICK = #{nick}
	           </if>
	           <if test="phone != '' and phone != null">
	           	,PHONE = #{phone}
	           </if>
	           <if test="email != '' and email != null">
	           	,EMAIL = #{email}
	           </if>
<!-- 	           <if test="fullPath != '' and fullPath != null"> -->
<!-- 	           	,FULL_PATH = #{fullPath} -->
<!-- 	           </if>	            -->
           WHERE NO = #{no}
		   AND QUIT_YN = 'N'		
	</update>
	
	<select id="selectMyClub" resultType="com.yeogi.app.member.vo.selectMyClubVo">
		SELECT CC.CATEGORY_NAME, M.NICK  AS MEMBER_NICK, C.NAME AS CLUB_NAME, C.CLUB_DESCRIPTION, C.ENROLL_DATE, CIF.FILE_URL
		FROM CLUB C
        JOIN CLUB_IMAGE_FILE CIF ON CIF.NO = C.NO
		JOIN MEMBER_CLUB MC ON MC.CLUB_NO = C.NO
		JOIN MEMBER M ON M.NO = C.CREATOR_NO
		JOIN CLUB_CATEGORY CC ON CC.CATEGORY_NO = C.CATEGORY_NO
		WHERE C.DEL_YN = 'N'
		AND M.NO = #{no}
		ORDER BY C.ENROLL_DATE DESC;
	</select>
	
</mapper>