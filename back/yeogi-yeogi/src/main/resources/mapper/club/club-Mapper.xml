<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ClubMapper">

    <select id="searchClub" resultType="com.yeogi.app.club.vo.ClubVo">
        SELECT C.*, CC.CATEGORY_NAME, I.FILE_URL
        FROM CLUB C
        JOIN CLUB_CATEGORY CC ON C.CATEGORY_NO = CC.CATEGORY_NO
        JOIN CLUB_IMAGE_FILE I ON C.NO = I.NO
        WHERE ${searchMenu} LIKE '%'||#{searchString}||'%'
    </select>

    <insert id="createClub">
        INSERT INTO CLUB(NO, CATEGORY_NO, CREATOR_NO, NAME, CLUB_DESCRIPTION, AGE_LIMIT, SIGNUP_LIMIT)
        VALUES (SEQ_CLUB_NO.NEXTVAL, #{categoryNo}, #{creatorNo}, #{name}, #{clubDescription}, #{ageLimit}, #{signupLimit})
    </insert>

    <insert id="insertClubImage">
<!--        <selectKey keyProperty="seqClubNo" resultType="Integer" order="BEFORE">-->
<!--            SELECT SEQ_CLUB_NO.CURRVAL FROM DUAL-->
<!--        </selectKey>-->
        <choose>
            <when test="clubImageFile != null or clubImageFile.equals(' ')">
                INSERT INTO CLUB_IMAGE_FILE(NO, FILE_URL, FILE_NAME) VALUES (SEQ_CLUB_NO.CURRVAL, '테스트2', '테스트2')
            </when>
            <otherwise>
                INSERT INTO CLUB_IMAGE_FILE(NO, FILE_URL, FILE_NAME) VALUES (SEQ_CLUB_NO.CURRVAL, '기본이미지', '기본이미지')
            </otherwise>
        </choose>


    </insert>

</mapper>